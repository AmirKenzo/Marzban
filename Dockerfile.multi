ARG PYTHON_VERSION=3.13
FROM python:$PYTHON_VERSION-slim-bookworm

COPY --from=builder . /code
WORKDIR /code

ENV PATH="/code/.venv/bin:$PATH"

COPY cli_wrapper.sh /usr/bin/marzban-cli
RUN chmod +x /usr/bin/marzban-cli

ENTRYPOINT ["bash", "-c", "python -m alembic upgrade head;", "python main.py"]
