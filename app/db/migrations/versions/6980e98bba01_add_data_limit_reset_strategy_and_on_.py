"""add data_limit_reset_strategy and on_hold_timeout to usertemplate table

Revision ID: 6980e98bba01
Revises: 9cfffef342cd
Create Date: 2025-04-14 21:38:13.835658

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '6980e98bba01'
down_revision = '9cfffef342cd'
branch_labels = None
depends_on = None

new_enum = sa.Enum('no_reset', 'day', 'week', 'month', 'year', name='userdatalimitresetstrategy')

def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    connection = op.get_bind()
    dialect = connection.dialect.name

    if dialect == "postgresql":
        new_enum.create(op.get_bind(), checkfirst=False)

    op.add_column('user_templates', sa.Column('on_hold_timeout', sa.DateTime(timezone=True), nullable=True))
    op.add_column('user_templates', sa.Column('data_limit_reset_strategy', new_enum, server_default='no_reset', nullable=False))
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    connection = op.get_bind()
    dialect = connection.dialect.name

    op.drop_column('user_templates', 'data_limit_reset_strategy')
    op.drop_column('user_templates', 'on_hold_timeout')
    if dialect == "postgresql":
        new_enum.drop(op.get_bind(), checkfirst=False)
    # ### end Alembic commands ###